# 論文執筆支援: 観測補助ツールの概要と使用手順

## はじめに

本文書は、論文の「観測補助ツールの開発」章における以下のセクションの内容を補完するための資料です：
- `\section{ツールの概要と目的}` で補うべき情報
- `\section{実際の使用手順}` の `\subsection{サーバー側}` と `\subsection{クライアント側}` で記述すべき内容

---

## 1. ツールの概要と目的 - 補足すべき情報

現在の論文に記載されている内容に加えて、以下の情報を補足することを推奨します。

### 1.1 技術的アーキテクチャの概要

**追加すべき内容:**
- **フロントエンド構成**: 純粋なJavaScript（フレームワーク不使用）、Aladin Lite v3による天体画像表示
- **データ形式**: CSV形式の星カタログを使用し、複数カタログの同時読み込みに対応
- **動作環境**: Webブラウザ上で動作する完全なクライアントサイドアプリケーション
- **依存ライブラリ**: 
  - Aladin Lite v3（天体画像表示）
  - PapaParse（CSVパース）
  - html2canvas（スクリーンショット機能）

**記述理由**: 読者が技術的な実装レベルを理解し、再現可能性や他の観測所での応用可能性を判断できるため。

### 1.2 具体的な機能リストの詳細化

**追加すべき内容:**

#### 1.2.1 座標検索と視野表示
- 赤経・赤緯による天体検索機能
- 25分角の視野円（Field of View）の可視化
- 複数のサーベイ画像（2MASS、DSS2、AllWISE、SDSS9、PanSTARRS）の切り替え対応

#### 1.2.2 標準星の自動抽出と表示
- 視野内（25分角以内）の星を最大500個まで自動検出
- RA/Dec座標、等級、分離角、位置角などの情報を表形式で提示
- Aladin画像上での視覚的マーカー表示（青い四角マーカー）
- クリックによる星の選択機能（選択された星は赤色マーカーで強調）

#### 1.2.3 位置角（P.A.）制約の可視化
- 観測装置のP.A.（Position Angle）設定機能
- P.A.許容範囲（デフォルト±30度）の設定
- P.A.制約を満たす推奨領域を黄色の扇形で表示
- 推奨ガイド星をマゼンタ色（紫）のマーカーで強調表示
- P.A.制約の有効/無効の切り替え機能

#### 1.2.4 測光フィルター機能
- カタログ内の任意の等級列によるフィルタリング
- 最小値・最大値の指定による星の絞り込み
- SN比要件に応じた柔軟な閾値設定

#### 1.2.5 MIMIZUKU専用機能
- デュアルフィールドビュー: ターゲットとガイド星の両方の視野（各1'×2'）を同時表示
- インタラクティブビューとPNG画像ビューの切り替え
- 実際の観測イメージのプレビュー機能

#### 1.2.6 観測可能性チェック機能
- 指定日時における天体の観測可能性を自動計算
- 対応観測所: Subaru、Keck、Magellan、VLT
- 表示情報:
  - 日の出・日の入り時刻
  - 薄明（天文薄明、航海薄明、市民薄明）の開始・終了時刻
  - 天体の高度変化（時系列グラフ）
  - 観測可能な時間帯の可視化

**記述理由**: 論文で述べられている「機能」を具体的に列挙することで、ツールの完成度と実用性を明確に示すため。

### 1.3 従来手法との比較

**追加すべき内容:**
- **従来の方法**: 天体カタログデータベース（例：SIMBAD、VizieR）での個別検索、手動での座標計算、観測計画ソフトウェア（例：Staralt）の別途使用
- **本ツールの利点**:
  - 一つのインターフェースで全ての確認作業が完結
  - 視覚的な確認（Aladin画像）とデータ的な確認（表形式）の両立
  - 観測者が独自のカタログ（例：K型巨星カタログ）を使用可能
  - リアルタイムでのフィルタリングとインタラクティブな操作
  - 観測立案の効率化（数時間かかる作業を数分に短縮）

**記述理由**: 本ツールの学術的・実用的な価値を明確にし、開発の必要性を強調するため。

### 1.4 想定される利用シーン

**追加すべき内容:**
- **観測提案書（Proposal）作成時**: 目標天体周辺の標準星の有無を確認し、観測可能性を評価
- **観測計画立案時**: 実際の観測日程における天体の高度や観測可能時間を確認
- **観測現場での確認**: 観測当日に迅速にガイド星を選択し、装置のセットアップを支援
- **研究グループでの共有**: Web URLを共有することで、複数の観測者が同じ情報にアクセス可能

**記述理由**: 読者がツールの実用的な応用場面を具体的にイメージできるようにするため。

### 1.5 将来的な拡張可能性

**追加すべき内容:**
- **時系列データ機能**: NEOWISE等の時系列観測データを統合し、標準星の変光の有無を確認可能に（プロトタイプ実装手順は別ドキュメント参照）
- **他のカタログとの統合**: GAIA、2MASS、AllWISE等の公開カタログとの自動マッチング
- **API化**: バックエンドサーバーを構築し、大規模データの高速検索やバッチ処理に対応
- **多波長対応**: X線、電波など、中赤外線以外の波長帯の標準星検索にも対応

**記述理由**: ツールの発展性と長期的な研究への貢献可能性を示すため。

### 1.6 ツールの設計方針

**追加すべき内容:**
- **ユーザーフレンドリー**: 専門知識がなくても直感的に操作可能なインターフェース
- **柔軟性**: 観測者が独自の等級閾値やP.A.制約を設定可能
- **再現性**: 検索結果や設定をURLパラメータやsessionStorageで保存し、共有・再現が容易
- **可搬性**: サーバー不要で、HTMLファイルをローカルに配置するだけで動作可能
- **拡張性**: モジュール化された設計により、新機能の追加が容易

**記述理由**: ツール開発における設計思想を明確にし、ソフトウェア工学的な観点からの評価を可能にするため。

---

## 2. 実際の使用手順 - サーバー側

### 2.1 サーバー側の前提条件

**記述すべき内容:**

現在のツールは**完全なクライアントサイドアプリケーション**として実装されており、基本的な使用においては専用のサーバーは不要です。しかし、以下の場面ではサーバーの構築が推奨されます：

- 複数の観測者が常時アクセスする場合
- 時系列データ機能など、大規模データを扱う拡張機能を追加する場合
- データベース検索や計算処理をサーバー側で実行する場合

### 2.2 基本的なサーバーセットアップ（Webサーバー）

**記述すべき内容:**

#### 2.2.1 静的ファイル配信用Webサーバーの構築

最もシンプルな構成として、静的ファイル（HTML/JavaScript/CSS）を配信するWebサーバーを構築します。

**必要な環境:**
- Linux/Unixサーバー（Ubuntu、CentOSなど）
- Webサーバーソフトウェア（Nginx、Apache、またはNode.js）
- 公開用ドメイン（オプション）

**手順（Nginxの例）:**

```bash
# 1. Nginxのインストール（Ubuntu/Debianの場合）
sudo apt update
sudo apt install nginx

# 2. ファイルの配置
# リポジトリをクローン
git clone https://github.com/koji0215/web_standard_viewer.git
cd web_standard_viewer

# 3. ファイルをWebサーバーのドキュメントルートにコピー
sudo cp -r index.html viewer.html app.js BrightKg_WISE_unique.csv /var/www/html/standard_viewer/

# 4. Nginxの設定
sudo nano /etc/nginx/sites-available/standard_viewer

# 以下の内容を記述:
# server {
#     listen 80;
#     server_name your-domain.com;  # または IPアドレス
#     
#     root /var/www/html/standard_viewer;
#     index index.html;
#     
#     location / {
#         try_files $uri $uri/ =404;
#     }
#     
#     # CSVファイルのMIMEタイプを明示的に設定
#     location ~* \.csv$ {
#         add_header Content-Type text/csv;
#     }
# }

# 5. 設定を有効化
sudo ln -s /etc/nginx/sites-available/standard_viewer /etc/nginx/sites-enabled/
sudo nginx -t  # 設定の検証
sudo systemctl reload nginx

# 6. ファイアウォールの設定（必要に応じて）
sudo ufw allow 'Nginx HTTP'
```

**動作確認:**
```bash
# ブラウザで以下にアクセス
# http://your-server-ip/
# または
# http://your-domain.com/
```

#### 2.2.2 Node.jsによる簡易サーバーの構築（開発用）

開発・テスト環境では、Node.jsを使った簡易サーバーも有用です。

**手順:**
```bash
# 1. Node.jsのインストール（未インストールの場合）
# Ubuntu/Debianの場合:
curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
sudo apt-get install -y nodejs

# 2. http-serverのインストール
npm install -g http-server

# 3. サーバーの起動
cd /path/to/web_standard_viewer
http-server -p 8080

# 4. アクセス
# ブラウザで http://localhost:8080 にアクセス
```

### 2.3 拡張機能用バックエンドサーバーの構築（オプション）

**記述すべき内容:**

時系列データ表示などの拡張機能を実装する場合、FastAPIを使用したバックエンドサーバーが必要になります。詳細は別ドキュメント（`プロトタイプ実装手順.md`）を参照。

**概要:**
```bash
# 1. Python環境のセットアップ
python3 -m venv venv
source venv/bin/activate  # Linux/Mac
# または venv\Scripts\activate  # Windows

# 2. 必要なパッケージのインストール
pip install fastapi uvicorn[standard] pydantic astropy numpy pandas

# 3. FastAPIアプリケーションの起動
cd backend
uvicorn app.main:app --host 0.0.0.0 --port 8000

# 4. CORS設定の確認
# フロントエンドからのアクセスを許可するため、
# FastAPIのCORSミドルウェア設定が必要
```

**APIエンドポイントの例:**
- `GET /api/lightcurve/neowise?allwise_id=<ID>` - ライトカーブデータの取得
- `GET /health` - ヘルスチェック

### 2.4 サーバー運用上の注意点

**記述すべき内容:**

#### 2.4.1 セキュリティ対策
- HTTPSの使用（Let's Encryptなどで無料SSL証明書を取得）
- ファイアウォールの設定（必要なポート以外は閉じる）
- 定期的なサーバーソフトウェアのアップデート

#### 2.4.2 パフォーマンス最適化
- Nginxでのgzip圧縮有効化
- 静的ファイルのキャッシュ設定
- 大規模カタログファイルの場合はCDN配信の検討

#### 2.4.3 監視とメンテナンス
- アクセスログの定期確認
- ディスク容量の監視
- サーバーの稼働状況監視（UptimeRobotなど）

### 2.5 サーバー不要での運用（ローカル使用）

**記述すべき内容:**

サーバーを構築せず、各観測者のローカル環境で使用する方法：

```bash
# 1. リポジトリのクローンまたはZIPダウンロード
git clone https://github.com/koji0215/web_standard_viewer.git
# または GitHubからZIPをダウンロードして解凍

# 2. ブラウザで直接HTMLファイルを開く
# index.html をダブルクリックするか、
# ブラウザのアドレスバーに以下を入力:
# file:///path/to/web_standard_viewer/index.html

# 3. カタログファイルの配置
# 使用したいCSVカタログファイルを同じディレクトリに配置
```

**注意点:**
- `file://` プロトコルではセキュリティ制約により一部機能が制限される場合がある
- ローカルWebサーバー（上記のhttp-serverなど）の使用を推奨

---

## 3. 実際の使用手順 - クライアント側

### 3.1 初期設定と動作環境

**記述すべき内容:**

#### 3.1.1 動作環境の要件
- **Webブラウザ**: Google Chrome（推奨）、Firefox、Safari、Microsoft Edge（いずれも最新版）
- **画面解像度**: 1280×720ピクセル以上を推奨
- **インターネット接続**: Aladin Liteが天体画像をCDSサーバーから取得するため必要
- **JavaScriptの有効化**: 必須

#### 3.1.2 アクセス方法
- サーバー版: ブラウザで `http://your-server-address/` にアクセス
- ローカル版: `index.html` をブラウザで開く

### 3.2 基本的な操作フロー

**記述すべき内容:**

#### ステップ1: 目標天体の検索

1. **座標の入力**
   - 画面上部の「Target」欄に目標天体の座標を入力
   - 入力形式の例:
     - セクスジェシマル形式: `18h09m01.4800s -20d05m08.000s`
     - 度数形式: `272.256 -20.086`
     - 天体名: `Sgr A*`（Simbadで解決可能な名称）

2. **Searchボタンをクリック**
   - Aladin画像が目標天体にセンタリングされる
   - 赤い円（25分角の視野）が表示される

#### ステップ2: カタログの読み込み

1. **カタログファイルの準備**
   - CSV形式のカタログファイルを用意
   - 必須カラム: `ra`（赤経）、`dec`（赤緯）
   - 推奨カラム: 等級情報（`w1`、`w2`、`v_mag`など）

2. **カタログの読み込み**
   - 「Star Catalog」の「ファイルを選択」ボタンをクリック
   - CSVファイルを選択（複数ファイルの同時選択も可能）
   - 「Load Catalogs」ボタンをクリック
   - 視野内の星が自動的に抽出され、右パネルのリストに表示される

3. **カラム選択**
   - 「Display Columns」で表示したいカラムを選択
   - デフォルトでは分離角（separation）と位置角（pa）が表示される

#### ステップ3: P.A.（位置角）制約の設定

1. **P.A.の入力**
   - 「Instrument P.A.」欄に観測装置のP.A.を度数で入力（0-360度）

2. **許容範囲の設定**
   - 「P.A. Tolerance」欄に許容範囲を度数で入力（デフォルト: 30度）

3. **P.A.制約の有効化**
   - 「Restrict by P.A.」チェックボックスをオンにする
   - Aladin画像上に黄色の扇形が表示され、推奨領域が可視化される
   - 推奨範囲内のガイド星がマゼンタ色（紫）のマーカーで強調表示される

#### ステップ4: 等級フィルターの適用

1. **フィルター対象カラムの選択**
   - 「Magnitude Filter」の「Band」ドロップダウンから等級カラムを選択
   - 例: `w1`, `w2`, `v_mag`

2. **最小値・最大値の設定**
   - 「Min」欄に最小等級を入力（例: 10.0）
   - 「Max」欄に最大等級を入力（例: 14.0）

3. **フィルターの適用**
   - 「Apply Filter」ボタンをクリック
   - 指定範囲外の星が自動的にリストから除外される

4. **フィルターのクリア**
   - 「Clear Filter」ボタンをクリックするとフィルターが解除される

#### ステップ5: ガイド星の選択

1. **星のプレビュー**
   - 右パネルのリストで星をクリック
   - Aladin画像上でその星が赤いマーカーで強調表示される
   - 表中でも黄色の枠で強調表示される

2. **複数の星を比較**
   - 異なる星を順次クリックして、位置や等級を比較

3. **最終決定**
   - 適切なガイド星が見つかったら「Observe with this star」ボタンをクリック
   - これにより、選択された星の情報がハイライトされる

#### ステップ6: MIMIZUKU デュアルフィールドビューの表示

1. **モーダルを開く**
   - 「Show MIMIZUKU Dual Field」ボタンをクリック
   - 新しいモーダルウィンドウが開く

2. **インタラクティブビュー**
   - 初期状態ではインタラクティブなAladinビューが表示される
   - ターゲット視野（左）とガイド星視野（右）が並んで表示される
   - 各視野は1'×2'のサイズで、MIMIZUKU装置の実視野を模擬

3. **PNG画像ビューへの切り替え**
   - 「Switch to PNG View」ボタンをクリック
   - Aladin画像がPNG画像としてキャプチャされ、静止画として表示される
   - この画像は観測計画書や報告書に貼り付け可能

4. **PNG画像のダウンロード**
   - 「Download PNG」ボタンをクリック
   - PNG画像がローカルにダウンロードされる

#### ステップ7: 観測可能性チェック

1. **観測所の選択**
   - 「Observatory」ドロップダウンから観測所を選択
   - 選択肢: Subaru、Keck、Magellan、VLT

2. **観測日の設定**
   - 「Observation Date」欄に日付を入力（形式: YYYY-MM-DD）
   - 例: `2024-08-15`

3. **Check Observabilityボタンをクリック**
   - 新しいウィンドウまたはモーダルが開き、観測可能性情報が表示される

4. **表示される情報**
   - 日の出・日の入り時刻
   - 天文薄明、航海薄明、市民薄明の開始・終了時刻
   - 天体の高度変化グラフ（時刻 vs. 高度）
   - 観測可能な時間帯（高度30度以上など）

### 3.3 詳細ビューへの遷移（オプション）

**記述すべき内容:**

検索結果を詳細に確認したい場合、`viewer.html` に遷移することができます。

1. **遷移方法**
   - 「詳細ビューで表示 →」ボタンをクリック
   - `viewer.html` に自動的に遷移し、検索結果が保持される

2. **詳細ビューの特徴**
   - Aladin画像が左側に固定サイズ（400px）で表示
   - 星リストが右側に広く展開され、詳細情報を確認しやすい
   - 検索コントロールは非表示（結果の確認に特化）

3. **検索ページへの戻り方**
   - 画面上部の「← 新規検索」ボタンをクリック
   - `index.html` に戻り、新しい検索が可能

### 3.4 サーベイ画像の切り替え

**記述すべき内容:**

Aladin Liteでは複数のサーベイ画像を切り替えて表示できます。

1. **切り替え方法**
   - 「Survey」ドロップダウンから目的のサーベイを選択
   - 選択肢:
     - **2MASS**: 近赤外線（J、H、Kバンド）の三色合成画像
     - **DSS2**: 可視光（赤・青）の画像
     - **AllWISE**: 中赤外線（W1, W2, W3, W4）の画像
     - **SDSS9**: 可視光（u, g, r, i, zバンド）の高解像度画像
     - **PanSTARRS DR1**: 可視光の広視野サーベイ画像

2. **波長帯による使い分け**
   - 近赤外線（2MASS）: ダスト透過性が高く、銀河中心方向の観測に有用
   - 可視光（DSS2、SDSS9）: 星の形状や色を確認
   - 中赤外線（AllWISE）: K型巨星などの低温天体の確認

### 3.5 表示モードの切り替え

**記述すべき内容:**

星のリスト表示には2つのモードがあります。

1. **カード表示モード（デフォルト）**
   - 各星が個別のカードとして表示される
   - 視覚的に見やすく、初心者に優しいインターフェース

2. **テーブル表示モード**
   - 表形式で多数の星を一覧表示
   - ソート機能により、特定のカラムで並べ替えが可能
   - 多数の星を比較する際に有用

3. **切り替え方法**
   - 星リストの上部にある「Cards」「Table」ボタンで切り替え

### 3.6 トラブルシューティング

**記述すべき内容:**

#### よくある問題と対処法

1. **Aladin画像が表示されない**
   - **原因**: インターネット接続の問題、CDSサーバーのダウン
   - **対処**: インターネット接続を確認、しばらく時間を置いて再試行

2. **カタログの読み込みエラー**
   - **原因**: CSVファイルの形式が不正、必須カラムが欠落
   - **対処**: CSV形式を確認（特に`ra`と`dec`カラムの存在）、文字エンコーディングをUTF-8に統一

3. **P.A.制約が反映されない**
   - **原因**: 「Restrict by P.A.」チェックボックスがオフ
   - **対処**: チェックボックスをオンにする

4. **等級フィルターが効かない**
   - **原因**: 選択したカラムにデータが含まれていない、数値形式でない
   - **対処**: カタログファイルを確認し、等級データが数値形式で記録されているか確認

5. **MIMIZUKU PNGビューが真っ白になる**
   - **原因**: Aladin画像の読み込みが完了していない状態でPNG変換を実行
   - **対処**: 画像が完全に読み込まれるまで数秒待ってから再試行

---

## 4. 論文への記述例

以上の情報を踏まえ、実際の論文における記述例を以下に示します。

### 4.1 「ツールの概要と目的」セクションの記述例

```latex
\section{ツールの概要と目的}

K型巨星のMIR標準星としての有用性や、MIMIZUKUで観測できる明るさをもとにして
どの程度の領域がMIMIZUKUで観測可能になると期待されるかを確認してきた。
しかし、目標天体が実際に観測できるかどうかを判断するには、期待値的な考察だけでなく、
各観測者の目標天体の周辺に適切な標準星が実在するかを確認する必要がある。
また、観測者が求めるSN比によって、標準星に必要な明るさも異なるため、
各々がその明るさの閾値を柔軟に設定し、使用可能な標準星を調べられることが
観測立案の際には極めて有用である。

本章では、そのような確認作業を観測者が容易に行えるようにするための
補助ツールについて述べる。本ツールはWebブラウザ上で動作する
クライアントサイドアプリケーションとして実装されており、
純粋なJavaScript、Aladin Lite v3（天体画像表示）、PapaParse（CSVパース）を
使用している。基本的な動作として、観測者がWebページにアクセスし、
目標天体の座標を入力すると、25分角以内の星を自動抽出し、
Aladin画像でのビジュアル表示と表形式でのテキスト表示を行う。

主な機能は以下の通りである：
\begin{itemize}
    \item 座標検索および25分角の視野円表示
    \item 複数のサーベイ画像（2MASS、DSS2、AllWISE、SDSS9、PanSTARRS）の切り替え
    \item 位置角（P.A.）制約の可視化と推奨ガイド星の自動判定
    \item 測光フィルター機能による等級範囲の指定
    \item MIMIZUKU専用のデュアルフィールドビュー（実観測イメージの表示）
    \item 観測可能性チェック機能（日の出・日の入り、薄明時刻、天体高度の計算）
    \item 抽出された星のライトカーブ表示機能（時系列データ拡張機能として実装可能）
\end{itemize}

従来、このような作業はSIMBADやVizieRなどの天体カタログデータベースでの個別検索、
手動での座標計算、観測計画ソフトウェア（例：Staralt）の別途使用が必要であり、
数時間を要する煩雑な作業であった。本ツールを使用することで、
これらの作業を一つのインターフェースで数分以内に完結させることが可能となり、
観測立案の効率が大幅に向上する。

さらに、本ツールは観測者が独自のカタログ（例：K型巨星カタログ）を
CSV形式で読み込むことができるため、特定の標準星候補リストに基づいた
観測計画立案にも柔軟に対応可能である。
```

### 4.2 「実際の使用手順 - サーバー側」セクションの記述例

```latex
\subsection{サーバー側}

本ツールは完全なクライアントサイドアプリケーションとして実装されており、
基本的な使用においては専用のサーバー構築は不要である。
観測者は単にWebブラウザでHTMLファイルを開くか、
公開されたURLにアクセスするだけで使用できる。

ただし、複数の観測者が常時アクセスする場合や、
将来的に時系列データ表示などの拡張機能を追加する場合には、
Webサーバーまたはバックエンドサーバーの構築が推奨される。

\subsubsection{静的ファイル配信用Webサーバー}

最もシンプルな構成として、Nginxなどの軽量なWebサーバーを使用して
静的ファイル（HTML/JavaScript/CSS）を配信する方法がある。
具体的には、Ubuntu ServerにNginxをインストールし、
本ツールのファイル一式を\texttt{/var/www/html/}以下に配置することで、
HTTPプロトコル経由でのアクセスが可能となる。
セキュリティを考慮し、Let's Encryptを使用してHTTPS化することが望ましい。

\subsubsection{拡張機能用バックエンドサーバー}

時系列データ表示機能を実装する場合、FastAPIを使用したRESTful APIサーバーが必要となる。
サーバー側ではPython環境を構築し、FastAPI、SQLite（またはPostgreSQL）、
Astropyなどのライブラリをインストールする。
APIエンドポイント（例：\texttt{/api/lightcurve/neowise}）を実装し、
フロントエンドからのHTTPリクエストに対してJSONフォーマットでライトカーブデータを返す。

サーバー運用においては、以下の点に注意が必要である：
\begin{itemize}
    \item CORS（Cross-Origin Resource Sharing）設定: フロントエンドとバックエンドが
          異なるオリジンで動作する場合、CORSポリシーを適切に設定する必要がある。
    \item パフォーマンス最適化: Nginxでのgzip圧縮、静的ファイルのキャッシュ設定により、
          レスポンス速度を向上させる。
    \item 監視とメンテナンス: アクセスログの定期確認、ディスク容量の監視、
          サーバーソフトウェアの定期的なアップデートを実施する。
\end{itemize}
```

### 4.3 「実際の使用手順 - クライアント側」セクションの記述例

```latex
\subsection{クライアント側}

観測者は以下の手順で本ツールを使用し、標準星候補を検索・選択する。

\subsubsection{初期設定}

本ツールはGoogle Chrome、Firefox、Safari、Microsoft Edgeなどの
主要なWebブラウザで動作する。画面解像度は1280×720ピクセル以上を推奨する。
Aladin Liteが天体画像をCDSサーバーから取得するため、インターネット接続が必要である。

\subsubsection{目標天体の検索}

観測者は画面上部の「Target」欄に目標天体の座標を入力する。
入力形式はセクスジェシマル形式（例：\texttt{18h09m01.4800s -20d05m08.000s}）、
度数形式（例：\texttt{272.256 -20.086}）、
または天体名（例：\texttt{Sgr A*}、Simbadで解決可能な名称）に対応している。
「Search」ボタンをクリックすると、Aladin画像が目標天体にセンタリングされ、
25分角の視野円が赤色で表示される。

\subsubsection{カタログの読み込みと星の抽出}

次に、観測者は「Star Catalog」セクションで、CSV形式のカタログファイルを選択し、
「Load Catalogs」ボタンをクリックする。カタログファイルには少なくとも
\texttt{ra}（赤経）と\texttt{dec}（赤緯）のカラムが必須であり、
等級情報（例：\texttt{w1}, \texttt{w2}）も含めることが推奨される。
読み込まれたカタログから視野内（25分角以内）の星が自動的に抽出され、
右パネルのリストに表示される。同時に、Aladin画像上に青い四角マーカーで
各星の位置が可視化される。

\subsubsection{位置角（P.A.）制約の設定}

観測装置のP.A.制約を考慮する場合、観測者は「Instrument P.A.」欄に
P.A.の値（0-360度）を、「P.A. Tolerance」欄に許容範囲（デフォルト：30度）を入力し、
「Restrict by P.A.」チェックボックスをオンにする。
これにより、Aladin画像上に黄色の扇形で推奨領域が表示され、
P.A.制約を満たすガイド星がマゼンタ色（紫）のマーカーで強調表示される。

\subsubsection{等級フィルターの適用}

観測者が求めるSN比に基づいて標準星の明るさを絞り込む場合、
「Magnitude Filter」セクションで等級カラム（例：\texttt{w1}）を選択し、
最小値と最大値を入力して「Apply Filter」ボタンをクリックする。
指定範囲外の星が自動的にリストから除外され、適切な明るさの星のみが表示される。

\subsubsection{ガイド星の選択と確認}

観測者は右パネルのリストから星をクリックすることで、
その星の情報をプレビューできる。選択された星はAladin画像上で赤いマーカーで強調され、
表中でも黄色の枠で強調表示される。複数の星を順次クリックして比較し、
最適なガイド星を決定した後、「Observe with this star」ボタンをクリックする。

\subsubsection{MIMIZUKU デュアルフィールドビューの確認}

MIMIZUKU装置での実際の観測イメージを確認するため、
観測者は「Show MIMIZUKU Dual Field」ボタンをクリックする。
モーダルウィンドウが開き、ターゲット視野とガイド星視野（各1'×2'）が
並んで表示される。初期状態ではインタラクティブなAladinビューが表示されるが、
「Switch to PNG View」ボタンをクリックすることで、PNG画像として保存可能な
静止画に切り替えることができる。この画像は観測計画書や報告書に貼り付けることができる。

\subsubsection{観測可能性チェック}

観測日における天体の観測可能性を確認するため、
観測者は「Observatory」ドロップダウンから観測所（Subaru、Keck、Magellan、VLT）を選択し、
「Observation Date」欄に日付を入力して「Check Observability」ボタンをクリックする。
新しいウィンドウまたはモーダルが開き、日の出・日の入り時刻、薄明時刻、
天体の高度変化グラフが表示される。これにより、観測可能な時間帯を視覚的に確認できる。

以上の手順により、観測者は数分以内に目標天体周辺の標準星候補を検索・選択し、
観測計画を立案することが可能となる。
```

---

## 5. まとめ

本文書では、論文の「観測補助ツールの開発」章における
「ツールの概要と目的」セクションおよび「実際の使用手順」セクションに
記載すべき内容を詳細に整理しました。

### 主要なポイント

1. **ツールの概要と目的**では、技術的アーキテクチャ、具体的な機能リスト、
   従来手法との比較、想定される利用シーン、将来的な拡張可能性、設計方針を
   追加することで、ツールの全体像と学術的・実用的価値を明確に示すことができます。

2. **サーバー側の使用手順**では、基本的には専用サーバー不要であることを強調しつつ、
   Webサーバーの構築方法（Nginx、Node.js）や、拡張機能用のバックエンドサーバー（FastAPI）の
   セットアップ方法、運用上の注意点（セキュリティ、パフォーマンス、監視）を
   記載することが推奨されます。

3. **クライアント側の使用手順**では、初期設定から目標天体の検索、カタログ読み込み、
   P.A.制約設定、等級フィルター適用、ガイド星選択、MIMIZUKU確認、観測可能性チェックまでの
   一連の操作フローを詳細に記述することで、読者が実際にツールを使用できるレベルの
   理解を提供できます。

本文書の内容を参考に、論文の該当セクションを執筆していただければ幸いです。

---

**文書作成日**: 2024年12月22日  
**作成目的**: 論文執筆支援  
**対象章**: 観測補助ツールの開発
